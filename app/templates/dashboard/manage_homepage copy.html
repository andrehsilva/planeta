{% extends "dashboard/dashboard_base.html" %}
{% from "macros/_form_helpers.html" import render_field %}

{% block dashboard_content %}
<h1 class="text-3xl font-bold text-gray-800 mb-6">{{ title }}</h1>

<div class="bg-white p-8 rounded-lg shadow-md max-w-4xl mx-auto">
    <form method="POST" enctype="multipart/form-data" novalidate>
        {{ form.hidden_tag() }}
        <div class="space-y-12">

            {% set sections = {
                'Hero (Topo da Página)': ['hero_badge_text', 'hero_title', 'hero_subtitle', 'hero_whatsapp_button_text', 'hero_whatsapp_button_link', 'hero_highlight_text'],
                'Seção "O que oferecemos"': ['services_section_tagline', 'services_section_title', 'services_section_subtitle'],
                'Card 1 (Festas)': ['services_card1_icon', 'services_card1_title', 'services_card1_text', 'services_card1_item1', 'services_card1_item2', 'services_card1_item3', 'services_card1_cta_text', 'services_card1_cta_link'],
                'Card 2 (Passaporte)': ['services_card2_icon', 'services_card2_title', 'services_card2_text', 'services_card2_item1', 'services_card2_item2', 'services_card2_item3', 'services_card2_cta_text', 'services_card2_cta_link'],
                'Card 3 (Genérico)': ['services_card3_icon', 'services_card3_title', 'services_card3_text', 'services_card3_item1', 'services_card3_item2', 'services_card3_item3', 'services_card3_cta_text', 'services_card3_cta_link'],
                'Seção "Por que nos escolher"': ['values_section_tagline', 'values_section_title', 'values_section_subtitle', 'values_card1_icon', 'values_card1_title', 'values_card1_text', 'values_card2_icon', 'values_card2_title', 'values_card2_text', 'values_card3_icon', 'values_card3_title', 'values_card3_text'],
                'Seção "Infraestrutura"': ['structure_section_tagline', 'structure_section_title', 'structure_section_subtitle', 'structure_feature1_title', 'structure_feature1_text', 'structure_feature2_title', 'structure_feature2_text'],
                'Seção "Diário de bordo"': ['blog_section_tagline', 'blog_section_title', 'blog_section_subtitle', 'blog_cta_text'],
                'Seção CTA Final': ['cta_title', 'cta_subtitle', 'cta_whatsapp_button_text', 'cta_form_button_text'],
                'Seção "Localização"': ['location_section_tagline', 'location_section_title', 'location_section_subtitle', 'location_card_title', 'location_address_title', 'location_address_text', 'location_phone_title', 'location_phone_text', 'location_hours_title', 'location_hours_text', 'location_gmaps_button_text', 'location_gmaps_link', 'location_image_alt']
            } %}

            {% for title, fields in sections.items() %}
            <fieldset class="border-t border-gray-200 pt-6">
                <legend class="text-lg font-medium text-gray-900">{{ title }}</legend>
                <div class="space-y-4 mt-4">
                    {% for field_name in fields %}
                        {{ render_field(form[field_name], rows=3) }}
                    {% endfor %}
                </div>
            </fieldset>
            {% endfor %}

            <fieldset class="border-t border-gray-200 pt-6">
                <legend class="text-lg font-medium text-gray-900">Galeria da Seção "Estrutura"</legend>
                
                <h4 class="text-md font-medium text-gray-800 mt-6 mb-2">Imagens Atuais</h4>
                {% if content.structure_images %}
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    {% for image in content.structure_images %}
                    <div class="relative group">
                        <img src="{{ url_for('static', filename='uploads/' + image.filename) }}" alt="{{ image.caption }}" class="w-full h-32 object-cover rounded-md">
                        <div class="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                            <form method="POST" action="{{ url_for('dashboard.delete_structure_image', image_id=image.id) }}" onsubmit="return confirm('Tem certeza que deseja excluir esta imagem?');">
                                <button type="submit" class="text-white bg-red-600 hover:bg-red-700 p-2 rounded-full" title="Excluir Imagem">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-sm text-gray-500">Nenhuma imagem na galeria ainda.</p>
                {% endif %}

                <div class="mt-4">
                    {{ render_field(form.gallery_images, multiple="multiple", type="file") }}
                    <p class="text-xs text-gray-500 mt-1">Você pode selecionar várias imagens de uma vez para adicionar à galeria. As imagens existentes não serão removidas.</p>
                </div>
            </fieldset>

            <div class="pt-5">
                {{ form.submit(class="w-full inline-flex justify-center py-3 px-6 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700") }}
            </div>
        </div>
    </form>
</div>
{% endblock %}